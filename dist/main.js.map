{"version":3,"sources":["webpack:///webpack/universalModuleDefinition","webpack:///webpack/bootstrap 03ae793f3700a1eea372","webpack:///./src/main.js","webpack:///./src/App.js","webpack:///./src/services/Auth.js","webpack:///./src/logger.js","webpack:///./src/settings.js","webpack:///./src/Devices.js","webpack:///./src/Utils.js","webpack:///./src/services/SignalDetection.js"],"names":["App","run","logger","log","DEBUG_DEFAULT_CODE","auth","Auth","bluetooth","Bluetooth","serialPort","settings","pin","bluetoothSerial","relay","Relay","relayPin","knockDevice","KnockDevice","knockPin","signalDetectionService","SignalDetectionService","triggerRelay","timeout","set","setTimeout","isReadyToSetUpNewCode","onDataReceived","data","isFirstPress","firstPressTimestamp","onKnock","e","Date","getTime","timestamp","deltaTime","putTimestamp","setCode","onSignalDetect","code","authenticated","verifyCode","DEFAULT_FLUCTUATION","FLUCTUATION_SHIFT","fluctuationPct","Array","length","slice","signalEnd","codeEnd","coeff","fluctuation","toFixed","result","forEach","codeItem","index","codeItemNormalized","signalItem","gt","parseFloat","lt","withinRange","val","Logger","isEnabled","message","arg","txt","console","print","bool","enabled","P2","P3","Serial3","DEFAULT_BAUD_RATE","DEFAULT_DEBOUNCE_TIMEOUT","options","serial","rate","baudRate","debouceTimeout","debounceTimeout","setup","receivedDataArray","onDataReceivedCallback","onDataReceivedDebounced","_onDataReceived","on","onDataReceiving","bind","push","join","callback","write","KNOCK_DEVICE_SET_WATCH_OPTS_DEFAULT","repeat","debounce","edge","KNOCK_DEVICE_DEBOUNCE","setWatchOpts","onKnockCallback","shakeTimeout","watcher","onKnockEvent","undefined","setWatch","func","wait","immediate","timeoutId","context","args","arguments","later","apply","callNow","clearTimeout","CODE_DETECT_TIMEOUT_DEFAULT","codeDetectionTimeout","signalTimestamps","signalDetectionInProgress","updateCodeDetectionDebounced","detectCodeDebounced","onCodeDetected","onSignalDetectCallback"],"mappings":"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","file":"main.js","sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory();\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine([], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"main\"] = factory();\n\telse\n\t\troot[\"main\"] = factory();\n})(this, function() {\nreturn \n\n\n/** WEBPACK FOOTER **\n ** webpack/universalModuleDefinition\n **/"," \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId])\n \t\t\treturn installedModules[moduleId].exports;\n\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\texports: {},\n \t\t\tid: moduleId,\n \t\t\tloaded: false\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.loaded = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(0);\n\n\n\n/** WEBPACK FOOTER **\n ** webpack/bootstrap 03ae793f3700a1eea372\n **/","import { App } from \"./App\";\n\nApp.run();\n\n\n\n/** WEBPACK FOOTER **\n ** ./src/main.js\n **/","import { Auth } from \"./services/Auth\";\nimport { logger } from \"./logger\";\nimport { settings } from \"./settings\";\nimport { Bluetooth, Relay, KnockDevice } from \"./Devices\";\nimport { SignalDetectionService } from \"./services/SignalDetection\";\n\nlogger.log('main.js');\n\nconst DEBUG_DEFAULT_CODE = [\n  352.18447023809,523.22069642856,955.59352380951,1151.93428571428,1838.82752380952,2025.70342857142\n];\n\nlet App = {\n\n  run: () => {\n\n    let auth = new Auth();\n    let bluetooth = new Bluetooth({serialPort: settings.pin.bluetoothSerial});\n    let relay = new Relay({pin: settings.pin.relayPin});\n    let knockDevice = new KnockDevice({pin: settings.pin.knockPin});\n\n    let signalDetectionService = new SignalDetectionService();\n\n    let triggerRelay = (relay, timeout = 400) => {\n      relay.set(0);\n      setTimeout((()=>{\n        relay.set(1)\n      }), timeout);\n    };\n\n    let isReadyToSetUpNewCode = false;\n    bluetooth.onDataReceived( (data) => {\n      if (data === \"set\") {\n        isReadyToSetUpNewCode = true;\n      }\n      if (data === \"open\") {\n        triggerRelay(relay);\n      }\n    });\n\n    let isFirstPress = true;\n    let firstPressTimestamp = 0;\n    knockDevice.onKnock((e) => {\n\n      if (isFirstPress) {\n        firstPressTimestamp = (new Date()).getTime();\n        isFirstPress = false;\n      } else {\n        let timestamp = (new Date()).getTime();\n        let deltaTime = timestamp - firstPressTimestamp;\n        signalDetectionService.putTimestamp(deltaTime);\n      }\n\n    });\n\n    // TODO: set the code manually\n    auth.setCode(DEBUG_DEFAULT_CODE);\n\n    signalDetectionService.onSignalDetect( (code) => {\n\n      logger.log('code-detected', code);\n\n      if (isReadyToSetUpNewCode) {\n        // TODO: store new code in FlashEEPROM\n        // TODO: details https://www.espruino.com/FlashEEPROM\n        auth.setCode(code);\n        logger.log('new code has been set');\n        isReadyToSetUpNewCode = false;\n      } else {\n\n        let authenticated = auth.verifyCode(code);\n        logger.log('authenticated', authenticated);\n\n        if (authenticated) {\n          triggerRelay(relay);\n        }\n\n        isFirstPress = true;\n        firstPressTimestamp = 0;\n\n      }\n    });\n\n  }\n\n};\n\nexport { App };\n\n\n\n/** WEBPACK FOOTER **\n ** ./src/App.js\n **/","import {logger} from \"./../logger\";\n\nlogger.log('Auth.js');\n\nconst DEFAULT_FLUCTUATION = 0.05;\nconst FLUCTUATION_SHIFT = 0.01;\n\nconst Auth = class {\n\n  constructor() {\n    this.code = []; // storing key code, an array of timestamps\n    this.fluctuationPct = DEFAULT_FLUCTUATION; \n  }\n\n  setCode(code){\n    if (!code) return;\n    if (!(code instanceof Array)) return;\n    this.code = code;\n  }\n  getCode(){\n    return this.code;\n  }\n\n  verifyCode(code){\n    if (!code) return false;\n    if (!(code instanceof Array)) return false;\n    if (code.length !== this.code.length) return false;\n\n    const [signalEnd] = code.slice(-1);\n    const [codeEnd] = this.code.slice(-1);\n\n    let coeff = signalEnd/codeEnd;\n    let fluctuation = +(signalEnd * this.fluctuationPct + FLUCTUATION_SHIFT).toFixed(2);\n\n    let result = true;\n\n    this.code.forEach( (codeItem, index) => {\n      let codeItemNormalized = +(codeItem*coeff).toFixed(2);\n      let signalItem = code[index];\n\n      let gt = +(parseFloat(codeItemNormalized + fluctuation )).toFixed(2);\n      let lt = +(parseFloat(codeItemNormalized - fluctuation )).toFixed(2);\n\n      let withinRange = gt >= signalItem && lt <= signalItem;\n\n      if (!withinRange) result = false;\n    } );\n\n    logger.log(\"Auth.verifyCode\", result);\n    return result;\n  }\n\n  setFluctuation(val){\n    this.fluctuationPct = val || DEFAULT_FLUCTUATION;\n  }\n\n};\n\nexport { Auth };\n\n\n\n/** WEBPACK FOOTER **\n ** ./src/services/Auth.js\n **/","import { settings } from './settings';\n\n/**\n * Simplest silly logger for debugging\n *\n * Actually there is a bug with it.\n * For some reason the app is unstable when\n * something is pushed into console.log,\n * as I found - Espruino waits for recipients for logged data\n * and breaks logic if there are no ones\n *\n * @type {Logger}\n */\nconst Logger = class {\n\n  constructor (bluetoothSerial) {\n    this.isEnabled = false;\n    this.bluetoothSerial = bluetoothSerial;\n  }\n\n  log (message, arg) {\n    if (!this.isEnabled) return false;\n    let txt = `${message}: ${arg}`;\n    if (console && console.log)\n      console.log(txt);\n    if (this.bluetoothSerial)\n      this.bluetoothSerial.print(txt);\n  }\n\n  enabled (bool) {\n    this.isEnabled = bool;\n  }\n\n};\n\nlet logger = new Logger(settings.pin.bluetoothSerial);\n\n// TODO: enable when debugging\nlogger.enabled(true);\n\nexport { logger };\n\n\n\n/** WEBPACK FOOTER **\n ** ./src/logger.js\n **/","\n// mocking for testing\n// TODO: do not include in prod\n// let P2 = P2 || null;\n// let P3 = P3 || null;\n// let Serial3 = Serial3 || null;\n\nconst settings = {\n  pin: {\n    knockPin: P2,\n    relayPin: P3,\n    bluetoothSerial: Serial3\n  }\n};\n\nexport { settings };\n\n\n\n/** WEBPACK FOOTER **\n ** ./src/settings.js\n **/","import { logger } from \"./logger\";\nimport {debounce} from \"./Utils\";\n\nlogger.log('Devices.js');\n\n/**\n * Bluetooth module\n * example:\n *\n  ```\n    import { Bluetooth } from \"./Devices\";\n    let options = {\n      serialPort: <Object> // e.g. Serial3\n      baudRate: <Number> // e.g. 9600 <- this is default\n      debounceTimeout: <Number> // e.g. 100 <- this is default\n    };\n    let bluetooth = new Bluetooth(options);\n  ```\n *\n */\nconst DEFAULT_BAUD_RATE = 9600;\nconst DEFAULT_DEBOUNCE_TIMEOUT = 100;\n\nconst Bluetooth = class {\n\n  constructor(options){\n    let serial = options.serialPort;\n    let rate = options.baudRate || DEFAULT_BAUD_RATE;\n    let debouceTimeout = options.debounceTimeout || DEFAULT_DEBOUNCE_TIMEOUT;\n    serial.setup(rate);\n\n    this.receivedDataArray = [];\n    this.onDataReceivedCallback = (() => {});\n\n    this.onDataReceivedDebounced =\n      debounce( () => { this._onDataReceived() }, debouceTimeout );\n\n    serial.on('data', this.onDataReceiving.bind(this));\n\n  }\n\n  onDataReceiving(data){\n    this.receivedDataArray.push(data);\n    this.onDataReceivedDebounced();\n  }\n\n  _onDataReceived(){\n    let data = this.receivedDataArray.join(\"\");\n    logger.log(\"Bluetooth._onDataReceoved\", data);\n    this.onDataReceivedCallback(data);\n    this.receivedDataArray = [];\n  }\n\n  onDataReceived(callback){\n    this.onDataReceivedCallback = callback || (()=>{});\n  }\n\n};\n\n/**\n * Relay utility module\n * example:\n *\n\n ```\n  import { Relay } from \"./Devices\";\n  let options = {\n    pin: <Object>, // e,g, P1\n  };\n  let relay = new Relay(options);\n\n  relay.set(1);\n  relay.set(true);\n  relay.set(0);\n  relay.set(false);\n\n ```\n *\n */\n\nconst Relay = class {\n\n  constructor(options){\n    this.pin = options.pin;\n  }\n\n  set(bool){\n    this.pin.write(bool ? 1 : 0);\n  }\n\n};\n\n/**\n * KnockDevice module\n * example:\n *\n ```\n import { KnockDevice } from \"./Devices\";\n let options = {\n      pin: <Object>, // e,g, P1\n      setWatchOpts: <Object> // opts passed to setWatch fn\n    };\n let knockDevice = new KnockDevice(options);\n knockDevice.onKnock((e)=>{\n  // callback when knock\n });\n ```\n *\n */\n\nconst KNOCK_DEVICE_SET_WATCH_OPTS_DEFAULT = {\n  repeat: true,\n  debounce: 20,\n  edge: 'rising'\n};\nconst KNOCK_DEVICE_DEBOUNCE = 100;\n\nconst KnockDevice = class {\n\n  constructor(options) {\n    logger.log(\"setup KnockDevice\");\n    let pin = options.pin;\n    let setWatchOpts = options.setWatchOpts || KNOCK_DEVICE_SET_WATCH_OPTS_DEFAULT;\n    this.onKnockCallback = (()=>{});\n\n    // here we use KNOCK_DEVICE_DEBOUNCE\n    // in order to catch only first knocking\n    let shakeTimeout;\n    let watcher = (e) => {\n      if (shakeTimeout) return;\n      this.onKnockEvent(e);\n      shakeTimeout = setTimeout(\n        () => { shakeTimeout = undefined; }\n        , KNOCK_DEVICE_DEBOUNCE\n      );\n    };\n\n    setWatch(watcher, pin, setWatchOpts);\n\n  }\n\n  onKnockEvent(e) {\n    logger.log(\"KnockDevice onKnockEvent\");\n    this.onKnockCallback(e);\n  }\n\n  onKnock(callback) {\n    this.onKnockCallback = callback || (() => {});\n  }\n\n};\n\nexport { Bluetooth, Relay, KnockDevice };\n\n\n\n/** WEBPACK FOOTER **\n ** ./src/Devices.js\n **/","const debounce = (func, wait, immediate) => {\n  let timeoutId = null;\n  return function() {\n    let context = this, args = arguments;\n    let later = function() {\n      timeoutId = null;\n      if (!immediate) func.apply(context, args);\n    };\n    let callNow = immediate && !timeoutId;\n    if (timeoutId) clearTimeout(timeoutId);\n    timeoutId = setTimeout(later, wait);\n    if (callNow) func.apply(context, args);\n  };\n};\n\nexport { debounce };\n\n\n\n/** WEBPACK FOOTER **\n ** ./src/Utils.js\n **/","import { logger } from \"../logger\";\nimport { debounce } from \"../Utils\";\n\nlogger.log('signal-detection.js', 'loaded');\n\n/**\n *\n * Service that helps to putTimestamp timestamped code\n *\n */\n\nconst CODE_DETECT_TIMEOUT_DEFAULT = 2000;\n\nconst SignalDetectionService = class {\n\n  constructor() {\n\n    this.codeDetectionTimeout = CODE_DETECT_TIMEOUT_DEFAULT;\n    this.signalTimestamps = [];\n    this.signalDetectionInProgress = false;\n\n    this.updateCodeDetectionDebounced();\n\n  }\n\n  updateCodeDetectionDebounced (\n    codeDetectionTimeout =\n      this.codeDetectionTimeout || CODE_DETECT_TIMEOUT_DEFAULT\n  ) {\n    logger.log('SignalDetectionService.updateCodeDetectionDebounced()', codeDetectionTimeout);\n    this.detectCodeDebounced = debounce(\n      this.onCodeDetected.bind(this),\n      codeDetectionTimeout\n    );\n  }\n\n  /**\n   * @param timestamp\n   */\n  putTimestamp (timestamp) {\n    logger.log('SignalDetectionService.putTimestamp()', timestamp);\n    if (this.signalDetectionInProgress) {\n      this.signalTimestamps.push(timestamp);\n    }\n    this.signalDetectionInProgress = true;\n    this.detectCodeDebounced();\n  }\n\n  onCodeDetected () {\n    logger.log(\"SignalDetectionService.onCodeDetected\", 'called');\n\n    let callback = this.onSignalDetectCallback || (() => {});\n    callback(this.signalTimestamps);\n\n    this.signalTimestamps = [];\n    this.signalDetectionInProgress = false;\n  }\n\n  onSignalDetect(callback){\n    this.onSignalDetectCallback = callback; // todo check context\n  }\n\n  setDetectionTimeout (timeout) {\n    this.codeDetectionTimeout = timeout;\n    this.updateCodeDetectionDebounced();\n  }\n\n  getTimestamps(){\n    return this.signalTimestamps;\n  }\n\n};\n\nexport { SignalDetectionService };\n\n\n\n/** WEBPACK FOOTER **\n ** ./src/services/SignalDetection.js\n **/"],"sourceRoot":""}