{"version":3,"sources":["webpack:///webpack/universalModuleDefinition","webpack:///webpack/bootstrap b6a98c635e0dd041ca65","webpack:///./src/main.js","webpack:///./src/App.js","webpack:///./src/services/Auth.js","webpack:///./src/logger.js","webpack:///./src/settings.js","webpack:///./src/Devices.js","webpack:///./src/Utils.js","webpack:///./src/services/SignalDetection.js"],"names":["App","run","logger","log","DEBUG_DEFAULT_CODE","isReadyToSetUpNewCode","auth","Auth","servo","Servo","pin","settings","servoPin","button","Button","buttonPin","bluetooth","Bluetooth","serialPort","bluetoothSerial","signalDetectionService","SignalDetectionService","onDataReceived","onClick","e","timestamp","time","lastTime","putTimestamp","setCode","onSignalDetect","code","authenticated","verifyCode","move","fluctuation","Array","length","slice","signalEnd","codeEnd","coeff","result","forEach","codeItem","index","stamp","withinRange","Logger","isEnabled","message","arg","txt","console","print","bool","P2","P3","Serial3","SERVO_DEFAULT_DURATION","SERVO_DEFAULT_INTERVAL","options","currentInterval","currentPosition","range","offset","position","duration","cb","clearInterval","initialPosition","amt","moveFn","digitalPulse","E","clip","setInterval","SET_WATCH_OPTS_DEFAULT","repeat","debounce","edge","setWatchOpts","setWatch","btnClick","bind","btnClickCallback","callback","DEFAULT_BAUD_RATE","DEFAULT_DEBOUNCE_TIMEOUT","serial","rate","baudRate","debouceTimeout","debounceTimeout","setup","receivedDataArray","onDataReceivedCallback","onDataReceivedDebounced","_onDataReceived","on","onDataReceiving","data","push","join","func","wait","immediate","timeoutId","context","args","arguments","later","apply","callNow","clearTimeout","setTimeout","CODE_DETECT_TIMEOUT_DEFAULT","codeDetectionTimeout","signalTimestamps","signalDetectionInProgress","updateCodeDetectionDebounced","detectCodeDebounced","onCodeDetected","onSignalDetectCallback","timeout"],"mappings":"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","file":"main.js","sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory();\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine([], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"main\"] = factory();\n\telse\n\t\troot[\"main\"] = factory();\n})(this, function() {\nreturn \n\n\n/** WEBPACK FOOTER **\n ** webpack/universalModuleDefinition\n **/"," \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId])\n \t\t\treturn installedModules[moduleId].exports;\n\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\texports: {},\n \t\t\tid: moduleId,\n \t\t\tloaded: false\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.loaded = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(0);\n\n\n\n/** WEBPACK FOOTER **\n ** webpack/bootstrap b6a98c635e0dd041ca65\n **/","import { App } from \"./App\";\n\nApp.run();\n\n\n\n/** WEBPACK FOOTER **\n ** ./src/main.js\n **/","import { Auth } from \"./services/Auth\";\nimport { logger } from \"./logger\";\nimport { settings } from \"./settings\";\nimport { Servo, Button, Bluetooth } from \"./Devices\";\nimport { SignalDetectionService } from \"./services/SignalDetection\";\n\nlogger.log('main.js');\n\nconst DEBUG_DEFAULT_CODE = [\n  0.11071835714,0.08259338095,0.10016359523,0.30911060714,0.09569125595,0.51507855357,0.07772857142\n];\n\nlet App = {\n\n  run: () => {\n\n    let isReadyToSetUpNewCode = false;\n\n    let auth = new Auth();\n    let servo = new Servo({pin: settings.pin.servoPin});\n    let button = new Button({pin: settings.pin.buttonPin});\n    let bluetooth = new Bluetooth({serialPort: settings.pin.bluetoothSerial});\n\n    let signalDetectionService = new SignalDetectionService();\n\n    bluetooth.onDataReceived( () => {\n      logger.log('ready to set up new code');\n      isReadyToSetUpNewCode = true;\n    });\n\n    button.onClick((e) => {\n      // todo: generate timestamp based on `e` arg\n      // there is a mistake (e.time - e.lastTime) -> fix it\n      let timestamp = e.time - e.lastTime;\n      signalDetectionService.putTimestamp(timestamp);\n    });\n\n    // TODO: set the code manually\n    auth.setCode(DEBUG_DEFAULT_CODE);\n\n    signalDetectionService.onSignalDetect( (code) => {\n\n      logger.log('code-detected', code);\n\n      if (isReadyToSetUpNewCode) {\n        auth.setCode(code);\n        logger.log('new code has been set');\n        isReadyToSetUpNewCode = false;\n      } else {\n        let authenticated = auth.verifyCode(code);\n        logger.log('authenticated', authenticated);\n        servo.move(authenticated ? 0 : 1);\n      }\n    });\n\n  }\n\n};\n\nexport { App };\n\n\n\n/** WEBPACK FOOTER **\n ** ./src/App.js\n **/","import {logger} from \"./../logger\";\n\nlogger.log('Auth.js');\n\nconst Auth = class {\n\n  constructor() {\n    this.code = []; // storing key code, an array of timestamps\n    this.fluctuation = 150; // TODO: must be in percents\n  }\n\n  setCode(code){\n    if (!code) return;\n    if (!(code instanceof Array)) return;\n    this.code = code;\n  }\n  getCode(){\n    return this.code;\n  }\n\n  verifyCode(code){\n    if (!code) return false;\n    if (!(code instanceof Array)) return false;\n    if (code.length !== this.code.length) return false;\n\n    const [signalEnd] = code.slice(-1);\n    const [codeEnd] = this.code.slice(-1);\n\n    let coeff = signalEnd/codeEnd;\n    let result = true;\n    let fluctuation = this.fluctuation;\n    this.code.forEach( (codeItem, index) => {\n      let stamp = code[index]/coeff;\n      let withinRange = ((stamp + fluctuation) >= codeItem && (stamp - fluctuation) <= codeItem);\n      if (!withinRange)\n        result = false;\n    } );\n\n    return result;\n  }\n\n};\n\nexport { Auth };\n\n\n\n/** WEBPACK FOOTER **\n ** ./src/services/Auth.js\n **/","import { settings } from './settings';\n\n/**\n * Simplest silly logger for debugging\n *\n * Actually there is a bug with it.\n * For some reason the app is unstable when\n * something is pushed into console.log,\n * as I found - Espruino waits for recipients for logged data\n * and breaks logic if there are no ones\n *\n * @type {Logger}\n */\nconst Logger = class {\n\n  constructor (bluetoothSerial) {\n    this.isEnabled = false;\n    this.bluetoothSerial = bluetoothSerial;\n  }\n\n  log (message, arg) {\n    if (!this.isEnabled) return false;\n    let txt = `${message}: ${arg}`;\n    if (console && console.log)\n      console.log(txt);\n    if (this.bluetoothSerial)\n      this.bluetoothSerial.print(txt);\n  }\n\n  enabled (bool) {\n    this.isEnabled = bool;\n  }\n\n};\n\nlet logger = new Logger(settings.pin.bluetoothSerial);\n\n// TODO: enable when debugging\n//logger.enabled(true);\n\nexport { logger };\n\n\n\n/** WEBPACK FOOTER **\n ** ./src/logger.js\n **/","\n// mocking for testing\n// TODO: do not include in prod\n// let BTN1 = BTN1 || null;\n// let P3 = P3 || null;\n// let Serial3 = Serial3 || null;\n\nconst settings = {\n  pin: {\n    buttonPin: P2,\n    servoPin: P3,\n    bluetoothSerial: Serial3\n  }\n};\n\nexport { settings };\n\n\n\n/** WEBPACK FOOTER **\n ** ./src/settings.js\n **/","/**\n * Servo motor utility module\n * example:\n *\n\n  ```\n    import { Servo } from \"./Devices\";\n    let options = {\n      pin: <Object>, // e,g, P1\n    };\n    let servo = new Servo(options);\n\n    s.move(1); // moving to position 1 over 1 second\n    s.move(0); // moving to position 0 over 1 second\n    s.move(0.5, 3000); // moving to position 0.5 over 3 seconds\n\n    // moving to position 0 over 1 second, then move to position 1\n    s.move(0, 1000, function() {\n      s.move(1, 1000);\n    });\n  ```\n *\n*/\n\nimport { logger } from \"./logger\";\nimport {debounce} from \"./Utils\";\n\nlogger.log('Devices.js');\n\nconst SERVO_DEFAULT_DURATION = 1000;\nconst SERVO_DEFAULT_INTERVAL = 20;\n\nconst Servo = class {\n\n  constructor(options) {\n    this.pin = options.pin;\n    this.currentInterval = null;\n    this.currentPosition = null;\n    if (options && options.range) {\n      this.range = options.range;\n      this.offset = 1.5 - (options.range / 2);\n    } else {\n      this.offset = 1;\n      this.range = 1;\n    }\n  }\n\n  move(position, duration, cb) {\n\n    if (!duration) duration = SERVO_DEFAULT_DURATION;\n    if (!this.currentPosition) this.currentPosition = position;\n    if (this.currentInterval) clearInterval(this.currentInterval);\n\n    let initialPosition = this.currentPosition;\n    let amt = 0;\n\n    let moveFn = () => {\n\n      if (amt > 1) {\n        clearInterval(this.currentInterval);\n        delete this.currentInterval;\n        amt = 1;\n        if (cb) cb();\n      }\n      this.currentPosition = position * amt + initialPosition * (1 - amt);\n      digitalPulse(this.pin, 1, this.offset + E.clip(this.currentPosition,0,1) * this.range);\n      amt += 1000.0 / (SERVO_DEFAULT_INTERVAL * duration);\n\n    };\n\n    this.currentInterval = setInterval(moveFn, SERVO_DEFAULT_INTERVAL);\n  }\n\n};\n\n\n/**\n * Button module\n * example: \n *\n  ```\n    import { Button } from \"./Devices\";\n    let options = {\n      pin: <Object>, // e,g, P1\n      setWatchOpts: <Object> // opts passed to setWatch fn\n    };\n    let btn = new Button(options);\n ```\n * \n */\n\nconst SET_WATCH_OPTS_DEFAULT = {\n  repeat: true,\n  debounce: 20,\n  edge: 'rising'\n};\n\nconst Button = class {\n  \n  constructor(options) {\n    logger.log(\"setupButton\");\n    let pin = options.pin;\n    let setWatchOpts = options.setWatchOpts || SET_WATCH_OPTS_DEFAULT;\n    setWatch(this.btnClick.bind(this), pin, setWatchOpts);\n  }\n  \n  btnClick(e) {\n    logger.log(\"setupButton btnClick\");\n    this.btnClickCallback(e);\n  }\n\n  onClick(callback) {\n    this.btnClickCallback = callback || (() => {});\n  }\n  \n};\n\n/**\n * Bluetooth module\n * example:\n *\n  ```\n    import { Bluetooth } from \"./Devices\";\n    let options = {\n      serialPort: <Object> // e.g. Serial3\n      baudRate: <Number> // e.g. 9600 <- this is default\n      debounceTimeout: <Number> // e.g. 100 <- this is default\n    };\n    let bluetooth = new Bluetooth(options);\n  ```\n *\n */\nconst DEFAULT_BAUD_RATE = 9600;\nconst DEFAULT_DEBOUNCE_TIMEOUT = 100;\n\nconst Bluetooth = class {\n\n  constructor(options){\n    let serial = options.serialPort;\n    let rate = options.baudRate || DEFAULT_BAUD_RATE;\n    let debouceTimeout = options.debounceTimeout || DEFAULT_DEBOUNCE_TIMEOUT;\n    serial.setup(rate);\n\n    this.receivedDataArray = [];\n    this.onDataReceivedCallback = (() => {});\n\n    this.onDataReceivedDebounced =\n      debounce( () => { this._onDataReceived() }, debouceTimeout );\n\n    serial.on('data', this.onDataReceiving.bind(this));\n\n  }\n\n  onDataReceiving(data){\n    this.receivedDataArray.push(data);\n    this.onDataReceivedDebounced();\n  }\n\n  _onDataReceived(){\n    let data = this.receivedDataArray.join(\"\");\n    this.onDataReceivedCallback(data);\n    this.receivedDataArray = [];\n  }\n\n  onDataReceived(callback){\n    this.onDataReceivedCallback = callback || (()=>{});\n  }\n\n};\n  \nexport { Servo, Button, Bluetooth };\n\n\n\n/** WEBPACK FOOTER **\n ** ./src/Devices.js\n **/","const debounce = (func, wait, immediate) => {\n  let timeoutId = null;\n  return function() {\n    let context = this, args = arguments;\n    let later = function() {\n      timeoutId = null;\n      if (!immediate) func.apply(context, args);\n    };\n    let callNow = immediate && !timeoutId;\n    if (timeoutId) clearTimeout(timeoutId);\n    timeoutId = setTimeout(later, wait);\n    if (callNow) func.apply(context, args);\n  };\n};\n\nexport { debounce };\n\n\n\n/** WEBPACK FOOTER **\n ** ./src/Utils.js\n **/","import { logger } from \"../logger\";\nimport { debounce } from \"../Utils\";\n\nlogger.log('signal-detection.js', 'loaded');\n\n/**\n *\n * Service that helps to putTimestamp timestamped code\n *\n */\n\nconst CODE_DETECT_TIMEOUT_DEFAULT = 2000;\n\nconst SignalDetectionService = class {\n\n  constructor() {\n\n    this.codeDetectionTimeout = CODE_DETECT_TIMEOUT_DEFAULT;\n    this.signalTimestamps = [];\n    this.signalDetectionInProgress = false;\n\n    this.updateCodeDetectionDebounced();\n\n  }\n\n  updateCodeDetectionDebounced (\n    codeDetectionTimeout =\n      this.codeDetectionTimeout || CODE_DETECT_TIMEOUT_DEFAULT\n  ) {\n    logger.log('SignalDetectionService.updateCodeDetectionDebounced()', codeDetectionTimeout);\n    this.detectCodeDebounced = debounce(\n      this.onCodeDetected.bind(this),\n      codeDetectionTimeout\n    );\n  }\n\n  /**\n   * todo: define input, modify the `e` variable taken from espruino's `setWatch` fn\n   * @param timestamp\n   */\n  putTimestamp (timestamp) {\n    logger.log('SignalDetectionService.putTimestamp()', timestamp);\n    if (this.signalDetectionInProgress) {\n      this.signalTimestamps.push(timestamp);\n    }\n    this.signalDetectionInProgress = true;\n    this.detectCodeDebounced();\n  }\n\n  onCodeDetected () {\n    logger.log(\"SignalDetectionService.onCodeDetected\", 'called');\n\n    let callback = this.onSignalDetectCallback || (() => {});\n    callback(this.signalTimestamps);\n\n    this.signalTimestamps = [];\n    this.signalDetectionInProgress = false;\n  }\n\n  onSignalDetect(callback){\n    this.onSignalDetectCallback = callback; // todo check context\n  }\n\n  setDetectionTimeout (timeout) {\n    this.codeDetectionTimeout = timeout;\n    this.updateCodeDetectionDebounced();\n  }\n\n  getTimestamps(){\n    return this.signalTimestamps;\n  }\n\n};\n\nexport { SignalDetectionService };\n\n\n\n/** WEBPACK FOOTER **\n ** ./src/services/SignalDetection.js\n **/"],"sourceRoot":""}