{"version":3,"sources":["webpack:///webpack/universalModuleDefinition","webpack:///webpack/bootstrap d82dd4b7f6c384c8617f","webpack:///./src/main.js","webpack:///./src/Locker.js","webpack:///./src/Utils.js","webpack:///./src/Devices.js","webpack:///./src/Auth.js"],"names":["locker","Locker","buttonPin","BTN1","servoPin","P3","auth","Auth","DEFAULT_CODE","setCode","fluctuation","on","code","authenticated","verifyCode","servo","move","options","events","setupServo","button","setupButton","pin","isFirstPress","firstPressTimestamp","signalTimestamps","detection","cb","detectionDebounced","btnClick","Date","timestamp","deltaTime","push","setWatch","repeat","edge","debounce","Servo","eventName","callback","func","wait","immediate","timeoutId","context","args","arguments","later","apply","callNow","clearTimeout","setTimeout","DEFAULT_DURATION","DEFAULT_INTERVAL","currentInterval","currentPosition","range","offset","position","duration","clearInterval","initialPosition","amt","moveFn","digitalPulse","E","clip","setInterval","Array","length","slice","signalEnd","codeEnd","coeff","result","forEach","codeItem","index","stamp","withinRange"],"mappings":"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","file":"main.js","sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory();\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine([], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"main\"] = factory();\n\telse\n\t\troot[\"main\"] = factory();\n})(this, function() {\nreturn \n\n\n/** WEBPACK FOOTER **\n ** webpack/universalModuleDefinition\n **/"," \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId])\n \t\t\treturn installedModules[moduleId].exports;\n\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\texports: {},\n \t\t\tid: moduleId,\n \t\t\tloaded: false\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.loaded = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(0);\n\n\n\n/** WEBPACK FOOTER **\n ** webpack/bootstrap d82dd4b7f6c384c8617f\n **/","import { Locker } from \"./Locker\";\nimport { Auth } from \"./Auth\";\n\nlet locker = new Locker({\n  buttonPin: BTN1,\n  servoPin: P3\n});\n\nlet auth = new Auth();\n\n// TODO: set the code manually\nconst DEFAULT_CODE = [ 189.81586904765, 380.28420238092, 591.84163095231, 1036.09701785712, 1266.62794642860, 1892.38363095244, 2117.92424404760 ];\nauth.setCode(DEFAULT_CODE);\nauth.fluctuation = 200;\n\nlocker.on('code-detected', (code) => {\n  let authenticated = auth.verifyCode(code);\n  locker.servo.move(\n    authenticated ? 0 : 1, 1000\n  );\n});\n\nlocker.on('set-new-code', ()=>{\n\n});\n\n\n\n/** WEBPACK FOOTER **\n ** ./src/main.js\n **/","import {debounce} from \"./Utils\";\nimport {Servo} from \"./Devices\";\n\nconst Locker = class {\n\n  constructor(options){\n\n    this.events = {};\n\n    ({servoPin, buttonPin} = options);\n    this.servo = this.setupServo(servoPin);\n    this.button = this.setupButton(buttonPin);\n\n  }\n\n  setupButton(pin){\n\n    let isFirstPress = false;\n    let firstPressTimestamp = null;\n    let signalTimestamps = [];\n    let detection = () => {\n      isFirstPress = true;\n      let cb = this.events['code-detected'] || (()=>{});\n      cb(signalTimestamps);\n      signalTimestamps = [];\n    };\n    let detectionDebounced = debounce(detection, 2000);\n\n    function btnClick() {\n\n      if (isFirstPress) {\n        firstPressTimestamp = new Date();\n        isFirstPress = false;\n      } else {\n        let timestamp = new Date();\n        let deltaTime = timestamp - firstPressTimestamp;\n        detectionDebounced();\n        signalTimestamps.push(deltaTime);\n      }\n\n    }\n\n    setWatch(btnClick, pin, { repeat: true, edge: \"falling\", debounce: 20 });\n\n    return pin;\n\n  }\n\n  setupServo(pin){\n    let servo = new Servo(pin);\n    return servo;\n    // servo.move(1, 3000); // move to position 0.5 over 3 seconds\n  }\n\n  on(eventName, callback){\n    this.events[eventName] = callback;\n  }\n\n};\n\nexport { Locker };\n\n\n\n/** WEBPACK FOOTER **\n ** ./src/Locker.js\n **/","const debounce = (func, wait, immediate) => {\n  let timeoutId = null;\n  return function() {\n    let context = this, args = arguments;\n    let later = function() {\n      timeoutId = null;\n      if (!immediate) func.apply(context, args);\n    };\n    let callNow = immediate && !timeoutId;\n    if (timeoutId) clearTimeout(timeoutId);\n    timeoutId = setTimeout(later, wait);\n    if (callNow) func.apply(context, args);\n  };\n};\n\nexport { debounce };\n\n\n\n/** WEBPACK FOOTER **\n ** ./src/Utils.js\n **/","/*\n  Servo motor utility module\n  example:\n\n  ```\n    import { Servo } from \"./Devices\";\n    let servo = new Servo(P3);\n\n    s.move(1); // moving to position 1 over 1 second\n    s.move(0); // moving to position 0 over 1 second\n    s.move(0.5, 3000); // moving to position 0.5 over 3 seconds\n\n    // moving to position 0 over 1 second, then move to position 1\n    s.move(0, 1000, function() {\n      s.move(1, 1000);\n    });\n  ```\n*/\n\nconst DEFAULT_DURATION = 1000;\nconst DEFAULT_INTERVAL = 20;\nconst Servo = class {\n\n  constructor(pin,options) {\n    this.pin = pin;\n    this.currentInterval = null;\n    this.currentPosition = null;\n    if (options && options.range) {\n      this.range = options.range;\n      this.offset = 1.5 - (options.range / 2);\n    } else {\n      this.offset = 1;\n      this.range = 1;\n    }\n  }\n\n  move(position, duration, cb) {\n\n    if (!duration) duration = DEFAULT_DURATION;\n    if (!this.currentPosition) this.currentPosition = position;\n    if (this.currentInterval) clearInterval(this.currentInterval);\n\n    let initialPosition = this.currentPosition;\n    let amt = 0;\n\n    let moveFn = () => {\n\n      if (amt > 1) {\n        clearInterval(this.currentInterval);\n        delete this.currentInterval;\n        amt = 1;\n        if (cb) cb();\n      }\n      this.currentPosition = position * amt + initialPosition * (1 - amt);\n      digitalPulse(this.pin, 1, this.offset + E.clip(this.currentPosition,0,1) * this.range);\n      amt += 1000.0 / (DEFAULT_INTERVAL * duration);\n\n    };\n\n    this.currentInterval = setInterval(moveFn, DEFAULT_INTERVAL);\n  }\n\n};\n\nexport { Servo };\n\n\n\n/** WEBPACK FOOTER **\n ** ./src/Devices.js\n **/","const Auth = class {\n\n  constructor() {\n    this.code = []; // storing key code, an array of timestamps\n    this.fluctuation = 0.1;\n  }\n\n  setCode(code){\n    if (!code) return;\n    if (!(code instanceof Array)) return;\n    this.code = code;\n  }\n  getCode(){\n    return this.code;\n  }\n\n  verifyCode(code){\n    if (!code) return false;\n    if (!(code instanceof Array)) return false;\n    if (code.length !== this.code.length) return false;\n\n    const [signalEnd] = code.slice(-1);\n    const [codeEnd] = this.code.slice(-1);\n\n    let coeff = signalEnd/codeEnd;\n    let result = true;\n    let fluctuation = this.fluctuation;\n    this.code.forEach( (codeItem, index) => {\n      let stamp = code[index]/coeff;\n      let withinRange = ((stamp + fluctuation) >= codeItem && (stamp - fluctuation) <= codeItem);\n      if (!withinRange)\n        result = false;\n    } );\n\n    return result;\n  }\n\n};\n\nexport { Auth };\n\n\n\n/** WEBPACK FOOTER **\n ** ./src/Auth.js\n **/"],"sourceRoot":""}