!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.main=t():e.main=t()}(this,function(){return function(e){function t(i){if(n[i])return n[i].exports;var o=n[i]={exports:{},id:i,loaded:!1};return e[i].call(o.exports,o,o.exports,t),o.loaded=!0,o.exports}var n={};return t.m=e,t.c=n,t.p="",t(0)}([function(e,t,n){"use strict";var i=n(1);i.App.run()},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.App=void 0;var i=n(2),o=n(3),r=n(4),a=n(5),c=n(7);o.logger.log("main.js");var u=[.11071835714,.08259338095,.10016359523,.30911060714,.09569125595,.51507855357,.07772857142],l={run:function(){var e=!1,t=new i.Auth,n=new a.Bluetooth({serialPort:r.settings.pin.bluetoothSerial}),l=new a.Relay({pin:r.settings.pin.relayPin}),s=new a.KnockDevice({pin:r.settings.pin.knockPin}),f=new c.SignalDetectionService;n.onDataReceived(function(){o.logger.log("ready to set up new code"),e=!0}),s.onKnock(function(e){var t=e.time-e.lastTime;f.putTimestamp(t)}),t.setCode(u),f.onSignalDetect(function(n){if(o.logger.log("code-detected",n),e)t.setCode(n),o.logger.log("new code has been set"),e=!1;else{var i=t.verifyCode(n);o.logger.log("authenticated",i),i&&(l.set(0),setTimeout(function(){l.set(1)},400))}})}};t.App=l},function(e,t,n){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0}),t.Auth=void 0;var o=function(){function e(e,t){var n=[],i=!0,o=!1,r=void 0;try{for(var a,c=e[Symbol.iterator]();!(i=(a=c.next()).done)&&(n.push(a.value),!t||n.length!==t);i=!0);}catch(e){o=!0,r=e}finally{try{!i&&c.return&&c.return()}finally{if(o)throw r}}return n}return function(t,n){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return e(t,n);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),r=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),a=n(3);a.logger.log("Auth.js");var c=function(){function e(){i(this,e),this.code=[],this.fluctuation=150}return r(e,[{key:"setCode",value:function(e){e&&e instanceof Array&&(this.code=e)}},{key:"getCode",value:function(){return this.code}},{key:"verifyCode",value:function(e){if(!e)return!1;if(!(e instanceof Array))return!1;if(e.length!==this.code.length)return!1;var t=e.slice(-1),n=o(t,1),i=n[0],r=this.code.slice(-1),a=o(r,1),c=a[0],u=i/c,l=!0,s=this.fluctuation;return this.code.forEach(function(t,n){var i=e[n]/u,o=i+s>=t&&i-s<=t;o||(l=!1)}),l}}]),e}();t.Auth=c},function(e,t,n){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0}),t.logger=void 0;var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),r=n(4),a=function(){function e(t){i(this,e),this.isEnabled=!1,this.bluetoothSerial=t}return o(e,[{key:"log",value:function(e,t){if(!this.isEnabled)return!1;var n=e+": "+t;console&&console.log&&console.log(n),this.bluetoothSerial&&this.bluetoothSerial.print(n)}},{key:"enabled",value:function(e){this.isEnabled=e}}]),e}(),c=new a(r.settings.pin.bluetoothSerial);t.logger=c},function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n={pin:{knockPin:P2,relayPin:P3,bluetoothSerial:Serial3}};t.settings=n},function(e,t,n){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0}),t.KnockDevice=t.Relay=t.Bluetooth=void 0;var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),r=n(3),a=n(6);r.logger.log("Devices.js");var c=9600,u=100,l=function(){function e(t){var n=this;i(this,e);var o=t.serialPort,r=t.baudRate||c,l=t.debounceTimeout||u;o.setup(r),this.receivedDataArray=[],this.onDataReceivedCallback=function(){},this.onDataReceivedDebounced=(0,a.debounce)(function(){n._onDataReceived()},l),o.on("data",this.onDataReceiving.bind(this))}return o(e,[{key:"onDataReceiving",value:function(e){this.receivedDataArray.push(e),this.onDataReceivedDebounced()}},{key:"_onDataReceived",value:function(){var e=this.receivedDataArray.join("");this.onDataReceivedCallback(e),this.receivedDataArray=[]}},{key:"onDataReceived",value:function(e){this.onDataReceivedCallback=e||function(){}}}]),e}(),s=function(){function e(t){i(this,e),this.pin=t.pin}return o(e,[{key:"set",value:function(e){this.pin.write(e?1:0)}}]),e}(),f={repeat:!0,debounce:25,edge:"rising"},d=function(){function e(t){i(this,e),r.logger.log("setup KnockDevice");var n=t.pin,o=t.setWatchOpts||f;this.onKnockCallback=function(){},setWatch(this.onShakeEvent.bind(this),n,o)}return o(e,[{key:"onShakeEvent",value:function(e){r.logger.log("KnockDevice onShakeEvent"),this.onKnockCallback(e)}},{key:"onKnock",value:function(e){this.onKnockCallback=e||function(){}}}]),e}();t.Bluetooth=l,t.Relay=s,t.KnockDevice=d},function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(e,t,n){var i=null;return function(){var o=this,r=arguments,a=function(){i=null,n||e.apply(o,r)},c=n&&!i;i&&clearTimeout(i),i=setTimeout(a,t),c&&e.apply(o,r)}};t.debounce=n},function(e,t,n){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0}),t.SignalDetectionService=void 0;var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),r=n(3),a=n(6);r.logger.log("signal-detection.js","loaded");var c=2e3,u=function(){function e(){i(this,e),this.codeDetectionTimeout=c,this.signalTimestamps=[],this.signalDetectionInProgress=!1,this.updateCodeDetectionDebounced()}return o(e,[{key:"updateCodeDetectionDebounced",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.codeDetectionTimeout||c;r.logger.log("SignalDetectionService.updateCodeDetectionDebounced()",e),this.detectCodeDebounced=(0,a.debounce)(this.onCodeDetected.bind(this),e)}},{key:"putTimestamp",value:function(e){r.logger.log("SignalDetectionService.putTimestamp()",e),this.signalDetectionInProgress&&this.signalTimestamps.push(e),this.signalDetectionInProgress=!0,this.detectCodeDebounced()}},{key:"onCodeDetected",value:function(){r.logger.log("SignalDetectionService.onCodeDetected","called");var e=this.onSignalDetectCallback||function(){};e(this.signalTimestamps),this.signalTimestamps=[],this.signalDetectionInProgress=!1}},{key:"onSignalDetect",value:function(e){this.onSignalDetectCallback=e}},{key:"setDetectionTimeout",value:function(e){this.codeDetectionTimeout=e,this.updateCodeDetectionDebounced()}},{key:"getTimestamps",value:function(){return this.signalTimestamps}}]),e}();t.SignalDetectionService=u}])});
//# sourceMappingURL=main.min.js.map
