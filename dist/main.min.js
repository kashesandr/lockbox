!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.main=t():e.main=t()}(this,function(){return function(e){function t(o){if(n[o])return n[o].exports;var i=n[o]={exports:{},id:o,loaded:!1};return e[o].call(i.exports,i,i.exports,t),i.loaded=!0,i.exports}var n={};return t.m=e,t.c=n,t.p="",t(0)}([function(e,t,n){"use strict";var o=n(1);o.App.run()},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.App=void 0;var o=n(2),i=n(3),r=n(4),a=n(5),c=n(7);i.logger.log("main.js");var u=[.11071835714,.08259338095,.10016359523,.30911060714,.09569125595,.51507855357,.07772857142],l={run:function(){var e=new o.Auth,t=new a.Bluetooth({serialPort:r.settings.pin.bluetoothSerial}),n=new a.Relay({pin:r.settings.pin.relayPin}),l=new a.KnockDevice({pin:r.settings.pin.knockPin}),s=new c.SignalDetectionService,f=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:400;e.set(0),setTimeout(function(){e.set(1)},t)},d=!1;t.onDataReceived(function(e){"set"===e&&(d=!0),"open"===e&&f(n)}),l.onKnock(function(e){var t=e.time-e.lastTime;s.putTimestamp(t)}),e.setCode(u),s.onSignalDetect(function(t){if(i.logger.log("code-detected",t),d)e.setCode(t),i.logger.log("new code has been set"),d=!1;else{var o=e.verifyCode(t);i.logger.log("authenticated",o),o&&f(n)}})}};t.App=l},function(e,t,n){"use strict";function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0}),t.Auth=void 0;var i=function(){function e(e,t){var n=[],o=!0,i=!1,r=void 0;try{for(var a,c=e[Symbol.iterator]();!(o=(a=c.next()).done)&&(n.push(a.value),!t||n.length!==t);o=!0);}catch(e){i=!0,r=e}finally{try{!o&&c.return&&c.return()}finally{if(i)throw r}}return n}return function(t,n){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return e(t,n);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),r=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),a=n(3);a.logger.log("Auth.js");var c=function(){function e(){o(this,e),this.code=[],this.fluctuation=150}return r(e,[{key:"setCode",value:function(e){e&&e instanceof Array&&(this.code=e)}},{key:"getCode",value:function(){return this.code}},{key:"verifyCode",value:function(e){if(!e)return!1;if(!(e instanceof Array))return!1;if(e.length!==this.code.length)return!1;var t=e.slice(-1),n=i(t,1),o=n[0],r=this.code.slice(-1),a=i(r,1),c=a[0],u=o/c,l=!0,s=this.fluctuation;return this.code.forEach(function(t,n){var o=e[n]/u,i=o+s>=t&&o-s<=t;i||(l=!1)}),l}}]),e}();t.Auth=c},function(e,t,n){"use strict";function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0}),t.logger=void 0;var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),r=n(4),a=function(){function e(t){o(this,e),this.isEnabled=!1,this.bluetoothSerial=t}return i(e,[{key:"log",value:function(e,t){if(!this.isEnabled)return!1;var n=e+": "+t;console&&console.log&&console.log(n),this.bluetoothSerial&&this.bluetoothSerial.print(n)}},{key:"enabled",value:function(e){this.isEnabled=e}}]),e}(),c=new a(r.settings.pin.bluetoothSerial);t.logger=c},function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n={pin:{knockPin:P2,relayPin:P3,bluetoothSerial:Serial3}};t.settings=n},function(e,t,n){"use strict";function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0}),t.KnockDevice=t.Relay=t.Bluetooth=void 0;var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),r=n(3),a=n(6);r.logger.log("Devices.js");var c=9600,u=100,l=function(){function e(t){var n=this;o(this,e);var i=t.serialPort,r=t.baudRate||c,l=t.debounceTimeout||u;i.setup(r),this.receivedDataArray=[],this.onDataReceivedCallback=function(){},this.onDataReceivedDebounced=(0,a.debounce)(function(){n._onDataReceived()},l),i.on("data",this.onDataReceiving.bind(this))}return i(e,[{key:"onDataReceiving",value:function(e){this.receivedDataArray.push(e),this.onDataReceivedDebounced()}},{key:"_onDataReceived",value:function(){var e=this.receivedDataArray.join("");r.logger.log("Bluetooth._onDataReceoved",e),this.onDataReceivedCallback(e),this.receivedDataArray=[]}},{key:"onDataReceived",value:function(e){this.onDataReceivedCallback=e||function(){}}}]),e}(),s=function(){function e(t){o(this,e),this.pin=t.pin}return i(e,[{key:"set",value:function(e){this.pin.write(e?1:0)}}]),e}(),f={repeat:!0,debounce:20,edge:"rising"},d=100,v=function(){function e(t){var n=this;o(this,e),r.logger.log("setup KnockDevice");var i=t.pin,a=t.setWatchOpts||f;this.onKnockCallback=function(){};var c=void 0,u=function(e){c||(n.onKnockEvent(e),c=setTimeout(function(){c=void 0},d))};setWatch(u,i,a)}return i(e,[{key:"onKnockEvent",value:function(e){r.logger.log("KnockDevice onKnockEvent"),this.onKnockCallback(e)}},{key:"onKnock",value:function(e){this.onKnockCallback=e||function(){}}}]),e}();t.Bluetooth=l,t.Relay=s,t.KnockDevice=v},function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(e,t,n){var o=null;return function(){var i=this,r=arguments,a=function(){o=null,n||e.apply(i,r)},c=n&&!o;o&&clearTimeout(o),o=setTimeout(a,t),c&&e.apply(i,r)}};t.debounce=n},function(e,t,n){"use strict";function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0}),t.SignalDetectionService=void 0;var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),r=n(3),a=n(6);r.logger.log("signal-detection.js","loaded");var c=2e3,u=function(){function e(){o(this,e),this.codeDetectionTimeout=c,this.signalTimestamps=[],this.signalDetectionInProgress=!1,this.updateCodeDetectionDebounced()}return i(e,[{key:"updateCodeDetectionDebounced",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.codeDetectionTimeout||c;r.logger.log("SignalDetectionService.updateCodeDetectionDebounced()",e),this.detectCodeDebounced=(0,a.debounce)(this.onCodeDetected.bind(this),e)}},{key:"putTimestamp",value:function(e){r.logger.log("SignalDetectionService.putTimestamp()",e),this.signalDetectionInProgress&&this.signalTimestamps.push(e),this.signalDetectionInProgress=!0,this.detectCodeDebounced()}},{key:"onCodeDetected",value:function(){r.logger.log("SignalDetectionService.onCodeDetected","called");var e=this.onSignalDetectCallback||function(){};e(this.signalTimestamps),this.signalTimestamps=[],this.signalDetectionInProgress=!1}},{key:"onSignalDetect",value:function(e){this.onSignalDetectCallback=e}},{key:"setDetectionTimeout",value:function(e){this.codeDetectionTimeout=e,this.updateCodeDetectionDebounced()}},{key:"getTimestamps",value:function(){return this.signalTimestamps}}]),e}();t.SignalDetectionService=u}])});
//# sourceMappingURL=main.min.js.map
