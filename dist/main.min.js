!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.main=t():e.main=t()}(this,function(){return function(e){function t(i){if(n[i])return n[i].exports;var o=n[i]={exports:{},id:i,loaded:!1};return e[i].call(o.exports,o,o.exports,t),o.loaded=!0,o.exports}var n={};return t.m=e,t.c=n,t.p="",t(0)}([function(e,t,n){"use strict";var i=n(1);i.App.run()},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.App=void 0;var i=n(2),o=n(3),r=n(4),a=n(5),c=n(7);o.logger.log("main.js");var u=[352.18447023809,523.22069642856,955.59352380951,1151.93428571428,1838.82752380952,2025.70342857142],l={run:function(){var e=new i.Auth,t=new a.Bluetooth({serialPort:r.settings.pin.bluetoothSerial}),n=new a.Relay({pin:r.settings.pin.relayPin}),l=new a.KnockDevice({pin:r.settings.pin.knockPin}),s=new c.SignalDetectionService,f=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:400;e.set(0),setTimeout(function(){e.set(1)},t)},d=!1;t.onDataReceived(function(t){if("set"===t)d=!0;else if("open"===t)f(n);else if(t.indexOf("fluctuation ")!==-1){var i=parseFloat(t.split(" ")[1])||.05;e.setFluctuation(i)}});var v=!0,g=0;l.onKnock(function(e){if(v)g=(new Date).getTime(),v=!1;else{var t=(new Date).getTime(),n=t-g;s.putTimestamp(n)}}),e.setCode(u),s.onSignalDetect(function(t){if(o.logger.log("code-detected",t),d)e.setCode(t),o.logger.log("new code has been set"),d=!1;else{var i=e.verifyCode(t);o.logger.log("authenticated",i),i&&f(n)}v=!0,g=0})}};t.App=l},function(e,t,n){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0}),t.Auth=void 0;var o=function(){function e(e,t){var n=[],i=!0,o=!1,r=void 0;try{for(var a,c=e[Symbol.iterator]();!(i=(a=c.next()).done)&&(n.push(a.value),!t||n.length!==t);i=!0);}catch(e){o=!0,r=e}finally{try{!i&&c.return&&c.return()}finally{if(o)throw r}}return n}return function(t,n){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return e(t,n);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),r=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),a=n(3);a.logger.log("Auth.js");var c=.05,u=.01,l=function(){function e(){i(this,e),this.code=[],this.fluctuationPct=c}return r(e,[{key:"setCode",value:function(e){e&&e instanceof Array&&(this.code=e)}},{key:"getCode",value:function(){return this.code}},{key:"verifyCode",value:function(e){if(!e)return!1;if(!(e instanceof Array))return!1;if(e.length!==this.code.length)return!1;var t=e.slice(-1),n=o(t,1),i=n[0],r=this.code.slice(-1),c=o(r,1),l=c[0],s=i/l,f=+(i*this.fluctuationPct+u).toFixed(2),d=!0;return this.code.forEach(function(t,n){var i=+(t*s).toFixed(2),o=e[n],r=+parseFloat(i+f).toFixed(2),a=+parseFloat(i-f).toFixed(2),c=r>=o&&a<=o;c||(d=!1)}),a.logger.log("Auth.verifyCode",d),d}},{key:"setFluctuation",value:function(e){a.logger.log("Auth.setFluctuation",e),this.fluctuationPct=e||c}}]),e}();t.Auth=l},function(e,t,n){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0}),t.logger=void 0;var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),r=n(4),a=function(){function e(t){i(this,e),this.isEnabled=!1,this.bluetoothSerial=t}return o(e,[{key:"log",value:function(e,t){if(!this.isEnabled)return!1;var n=e+": "+t;console&&console.log&&console.log(n),this.bluetoothSerial&&this.bluetoothSerial.print(n)}},{key:"enabled",value:function(e){this.isEnabled=e}}]),e}(),c=new a(r.settings.pin.bluetoothSerial);t.logger=c},function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n={pin:{knockPin:P2,relayPin:P3,bluetoothSerial:Serial3}};t.settings=n},function(e,t,n){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0}),t.KnockDevice=t.Relay=t.Bluetooth=void 0;var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),r=n(3),a=n(6);r.logger.log("Devices.js");var c=9600,u=100,l=function(){function e(t){var n=this;i(this,e);var o=t.serialPort,r=t.baudRate||c,l=t.debounceTimeout||u;o.setup(r),this.receivedDataArray=[],this.onDataReceivedCallback=function(){},this.onDataReceivedDebounced=(0,a.debounce)(function(){n._onDataReceived()},l),o.on("data",this.onDataReceiving.bind(this))}return o(e,[{key:"onDataReceiving",value:function(e){this.receivedDataArray.push(e),this.onDataReceivedDebounced()}},{key:"_onDataReceived",value:function(){var e=this.receivedDataArray.join("");r.logger.log("Bluetooth._onDataReceoved",e),this.onDataReceivedCallback(e),this.receivedDataArray=[]}},{key:"onDataReceived",value:function(e){this.onDataReceivedCallback=e||function(){}}}]),e}(),s=function(){function e(t){i(this,e),this.pin=t.pin}return o(e,[{key:"set",value:function(e){this.pin.write(e?1:0)}}]),e}(),f={repeat:!0,debounce:20,edge:"rising"},d=100,v=function(){function e(t){var n=this;i(this,e),r.logger.log("setup KnockDevice");var o=t.pin,a=t.setWatchOpts||f;this.onKnockCallback=function(){};var c=void 0,u=function(e){c||(n.onKnockEvent(e),c=setTimeout(function(){c=void 0},d))};setWatch(u,o,a)}return o(e,[{key:"onKnockEvent",value:function(e){r.logger.log("KnockDevice onKnockEvent"),this.onKnockCallback(e)}},{key:"onKnock",value:function(e){this.onKnockCallback=e||function(){}}}]),e}();t.Bluetooth=l,t.Relay=s,t.KnockDevice=v},function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(e,t,n){var i=null;return function(){var o=this,r=arguments,a=function(){i=null,n||e.apply(o,r)},c=n&&!i;i&&clearTimeout(i),i=setTimeout(a,t),c&&e.apply(o,r)}};t.debounce=n},function(e,t,n){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0}),t.SignalDetectionService=void 0;var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),r=n(3),a=n(6);r.logger.log("signal-detection.js","loaded");var c=2e3,u=30,l=function(){function e(){i(this,e),this.codeDetectionTimeout=c,this.signalTimestamps=[],this.signalDetectionInProgress=!1,this.updateCodeDetectionDebounced()}return o(e,[{key:"updateCodeDetectionDebounced",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.codeDetectionTimeout||c;r.logger.log("SignalDetectionService.updateCodeDetectionDebounced()",e),this.detectCodeDebounced=(0,a.debounce)(this.onCodeDetected.bind(this),e)}},{key:"putTimestamp",value:function(e){r.logger.log("SignalDetectionService.putTimestamp()",e),this.signalTimestamps.length>u||(this.signalDetectionInProgress&&this.signalTimestamps.push(e),this.signalDetectionInProgress=!0,this.detectCodeDebounced())}},{key:"onCodeDetected",value:function(){r.logger.log("SignalDetectionService.onCodeDetected","called");var e=this.onSignalDetectCallback||function(){};e(this.signalTimestamps),this.signalTimestamps=[],this.signalDetectionInProgress=!1}},{key:"onSignalDetect",value:function(e){this.onSignalDetectCallback=e}},{key:"setDetectionTimeout",value:function(e){this.codeDetectionTimeout=e,this.updateCodeDetectionDebounced()}},{key:"getTimestamps",value:function(){return this.signalTimestamps}}]),e}();t.SignalDetectionService=l}])});