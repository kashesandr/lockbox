{"version":3,"sources":["main.min.js"],"names":["root","factory","exports","module","define","amd","this","modules","__webpack_require__","moduleId","installedModules","id","loaded","call","m","c","p","_App","App","run","Object","defineProperty","value","undefined","_Auth","_logger","_settings","_Devices","_SignalDetection","logger","log","DEBUG_DEFAULT_CODE","auth","Auth","bluetooth","Bluetooth","serialPort","settings","pin","bluetoothSerial","relay","Relay","relayPin","knockDevice","KnockDevice","knockPin","signalDetectionService","SignalDetectionService","triggerRelay","timeout","arguments","length","set","setTimeout","isReadyToSetUpNewCode","onDataReceived","data","onKnock","e","timestamp","time","lastTime","putTimestamp","setCode","onSignalDetect","code","authenticated","verifyCode","_classCallCheck","instance","Constructor","TypeError","_slicedToArray","sliceIterator","arr","i","_arr","_n","_d","_e","_s","_i","Symbol","iterator","next","done","push","err","Array","isArray","_createClass","defineProperties","target","props","descriptor","enumerable","configurable","writable","key","protoProps","staticProps","prototype","fluctuation","_code$slice","slice","_code$slice2","signalEnd","_code$slice3","_code$slice4","codeEnd","coeff","result","forEach","codeItem","index","stamp","withinRange","Logger","isEnabled","message","arg","txt","console","print","bool","P2","P3","Serial3","_Utils","DEFAULT_BAUD_RATE","DEFAULT_DEBOUNCE_TIMEOUT","options","_this","serial","rate","baudRate","debouceTimeout","debounceTimeout","setup","receivedDataArray","onDataReceivedCallback","onDataReceivedDebounced","debounce","_onDataReceived","on","onDataReceiving","bind","join","callback","write","KNOCK_DEVICE_SET_WATCH_OPTS_DEFAULT","repeat","edge","KNOCK_DEVICE_DEBOUNCE","_this2","setWatchOpts","onKnockCallback","shakeTimeout","watcher","onKnockEvent","setWatch","func","wait","immediate","timeoutId","context","args","later","apply","callNow","clearTimeout","CODE_DETECT_TIMEOUT_DEFAULT","codeDetectionTimeout","signalTimestamps","signalDetectionInProgress","updateCodeDetectionDebounced","detectCodeDebounced","onCodeDetected","onSignalDetectCallback"],"mappings":"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","file":"main.min.js","sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory();\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine([], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"main\"] = factory();\n\telse\n\t\troot[\"main\"] = factory();\n})(this, function() {\nreturn /******/ (function(modules) { // webpackBootstrap\n/******/ \t// The module cache\n/******/ \tvar installedModules = {};\n/******/\n/******/ \t// The require function\n/******/ \tfunction __webpack_require__(moduleId) {\n/******/\n/******/ \t\t// Check if module is in cache\n/******/ \t\tif(installedModules[moduleId])\n/******/ \t\t\treturn installedModules[moduleId].exports;\n/******/\n/******/ \t\t// Create a new module (and put it into the cache)\n/******/ \t\tvar module = installedModules[moduleId] = {\n/******/ \t\t\texports: {},\n/******/ \t\t\tid: moduleId,\n/******/ \t\t\tloaded: false\n/******/ \t\t};\n/******/\n/******/ \t\t// Execute the module function\n/******/ \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n/******/\n/******/ \t\t// Flag the module as loaded\n/******/ \t\tmodule.loaded = true;\n/******/\n/******/ \t\t// Return the exports of the module\n/******/ \t\treturn module.exports;\n/******/ \t}\n/******/\n/******/\n/******/ \t// expose the modules object (__webpack_modules__)\n/******/ \t__webpack_require__.m = modules;\n/******/\n/******/ \t// expose the module cache\n/******/ \t__webpack_require__.c = installedModules;\n/******/\n/******/ \t// __webpack_public_path__\n/******/ \t__webpack_require__.p = \"\";\n/******/\n/******/ \t// Load entry module and return exports\n/******/ \treturn __webpack_require__(0);\n/******/ })\n/************************************************************************/\n/******/ ([\n/* 0 */\n/***/ function(module, exports, __webpack_require__) {\n\n\t\"use strict\";\n\t\n\tvar _App = __webpack_require__(1);\n\t\n\t_App.App.run();\n\n/***/ },\n/* 1 */\n/***/ function(module, exports, __webpack_require__) {\n\n\t\"use strict\";\n\t\n\tObject.defineProperty(exports, \"__esModule\", {\n\t  value: true\n\t});\n\texports.App = undefined;\n\t\n\tvar _Auth = __webpack_require__(2);\n\t\n\tvar _logger = __webpack_require__(3);\n\t\n\tvar _settings = __webpack_require__(4);\n\t\n\tvar _Devices = __webpack_require__(5);\n\t\n\tvar _SignalDetection = __webpack_require__(7);\n\t\n\t_logger.logger.log('main.js');\n\t\n\tvar DEBUG_DEFAULT_CODE = [0.11071835714, 0.08259338095, 0.10016359523, 0.30911060714, 0.09569125595, 0.51507855357, 0.07772857142];\n\t\n\tvar App = {\n\t\n\t  run: function run() {\n\t\n\t    var auth = new _Auth.Auth();\n\t    var bluetooth = new _Devices.Bluetooth({ serialPort: _settings.settings.pin.bluetoothSerial });\n\t    var relay = new _Devices.Relay({ pin: _settings.settings.pin.relayPin });\n\t    var knockDevice = new _Devices.KnockDevice({ pin: _settings.settings.pin.knockPin });\n\t\n\t    var signalDetectionService = new _SignalDetection.SignalDetectionService();\n\t\n\t    var triggerRelay = function triggerRelay(relay) {\n\t      var timeout = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 400;\n\t\n\t      relay.set(0);\n\t      setTimeout(function () {\n\t        relay.set(1);\n\t      }, timeout);\n\t    };\n\t\n\t    var isReadyToSetUpNewCode = false;\n\t    bluetooth.onDataReceived(function (data) {\n\t      if (data === \"set\") {\n\t        isReadyToSetUpNewCode = true;\n\t      }\n\t      if (data === \"open\") {\n\t        triggerRelay(relay);\n\t      }\n\t    });\n\t\n\t    knockDevice.onKnock(function (e) {\n\t      // there is a mistake (e.time - e.lastTime) -> fix it\n\t      var timestamp = e.time - e.lastTime;\n\t      signalDetectionService.putTimestamp(timestamp);\n\t    });\n\t\n\t    // TODO: set the code manually\n\t    auth.setCode(DEBUG_DEFAULT_CODE);\n\t\n\t    signalDetectionService.onSignalDetect(function (code) {\n\t\n\t      _logger.logger.log('code-detected', code);\n\t\n\t      if (isReadyToSetUpNewCode) {\n\t        // TODO: store new code in FlashEEPROM\n\t        // TODO: details https://www.espruino.com/FlashEEPROM\n\t        auth.setCode(code);\n\t        _logger.logger.log('new code has been set');\n\t        isReadyToSetUpNewCode = false;\n\t      } else {\n\t        var authenticated = auth.verifyCode(code);\n\t        _logger.logger.log('authenticated', authenticated);\n\t\n\t        if (authenticated) {\n\t          triggerRelay(relay);\n\t        }\n\t      }\n\t    });\n\t  }\n\t\n\t};\n\t\n\texports.App = App;\n\n/***/ },\n/* 2 */\n/***/ function(module, exports, __webpack_require__) {\n\n\t\"use strict\";\n\t\n\tObject.defineProperty(exports, \"__esModule\", {\n\t  value: true\n\t});\n\texports.Auth = undefined;\n\t\n\tvar _slicedToArray = function () { function sliceIterator(arr, i) { var _arr = []; var _n = true; var _d = false; var _e = undefined; try { for (var _i = arr[Symbol.iterator](), _s; !(_n = (_s = _i.next()).done); _n = true) { _arr.push(_s.value); if (i && _arr.length === i) break; } } catch (err) { _d = true; _e = err; } finally { try { if (!_n && _i[\"return\"]) _i[\"return\"](); } finally { if (_d) throw _e; } } return _arr; } return function (arr, i) { if (Array.isArray(arr)) { return arr; } else if (Symbol.iterator in Object(arr)) { return sliceIterator(arr, i); } else { throw new TypeError(\"Invalid attempt to destructure non-iterable instance\"); } }; }();\n\t\n\tvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\t\n\tvar _logger = __webpack_require__(3);\n\t\n\tfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\t\n\t_logger.logger.log('Auth.js');\n\t\n\tvar Auth = function () {\n\t  function Auth() {\n\t    _classCallCheck(this, Auth);\n\t\n\t    this.code = []; // storing key code, an array of timestamps\n\t    this.fluctuation = 150; // TODO: must be in percents\n\t  }\n\t\n\t  _createClass(Auth, [{\n\t    key: \"setCode\",\n\t    value: function setCode(code) {\n\t      if (!code) return;\n\t      if (!(code instanceof Array)) return;\n\t      this.code = code;\n\t    }\n\t  }, {\n\t    key: \"getCode\",\n\t    value: function getCode() {\n\t      return this.code;\n\t    }\n\t  }, {\n\t    key: \"verifyCode\",\n\t    value: function verifyCode(code) {\n\t      if (!code) return false;\n\t      if (!(code instanceof Array)) return false;\n\t      if (code.length !== this.code.length) return false;\n\t\n\t      var _code$slice = code.slice(-1),\n\t          _code$slice2 = _slicedToArray(_code$slice, 1),\n\t          signalEnd = _code$slice2[0];\n\t\n\t      var _code$slice3 = this.code.slice(-1),\n\t          _code$slice4 = _slicedToArray(_code$slice3, 1),\n\t          codeEnd = _code$slice4[0];\n\t\n\t      var coeff = signalEnd / codeEnd;\n\t      var result = true;\n\t      var fluctuation = this.fluctuation;\n\t      this.code.forEach(function (codeItem, index) {\n\t        var stamp = code[index] / coeff;\n\t        var withinRange = stamp + fluctuation >= codeItem && stamp - fluctuation <= codeItem;\n\t        if (!withinRange) result = false;\n\t      });\n\t\n\t      return result;\n\t    }\n\t  }]);\n\t\n\t  return Auth;\n\t}();\n\t\n\texports.Auth = Auth;\n\n/***/ },\n/* 3 */\n/***/ function(module, exports, __webpack_require__) {\n\n\t'use strict';\n\t\n\tObject.defineProperty(exports, \"__esModule\", {\n\t  value: true\n\t});\n\texports.logger = undefined;\n\t\n\tvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\t\n\tvar _settings = __webpack_require__(4);\n\t\n\tfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\t\n\t/**\n\t * Simplest silly logger for debugging\n\t *\n\t * Actually there is a bug with it.\n\t * For some reason the app is unstable when\n\t * something is pushed into console.log,\n\t * as I found - Espruino waits for recipients for logged data\n\t * and breaks logic if there are no ones\n\t *\n\t * @type {Logger}\n\t */\n\tvar Logger = function () {\n\t  function Logger(bluetoothSerial) {\n\t    _classCallCheck(this, Logger);\n\t\n\t    this.isEnabled = false;\n\t    this.bluetoothSerial = bluetoothSerial;\n\t  }\n\t\n\t  _createClass(Logger, [{\n\t    key: 'log',\n\t    value: function log(message, arg) {\n\t      if (!this.isEnabled) return false;\n\t      var txt = message + ': ' + arg;\n\t      if (console && console.log) console.log(txt);\n\t      if (this.bluetoothSerial) this.bluetoothSerial.print(txt);\n\t    }\n\t  }, {\n\t    key: 'enabled',\n\t    value: function enabled(bool) {\n\t      this.isEnabled = bool;\n\t    }\n\t  }]);\n\t\n\t  return Logger;\n\t}();\n\t\n\tvar logger = new Logger(_settings.settings.pin.bluetoothSerial);\n\t\n\t// TODO: enable when debugging\n\t//logger.enabled(true);\n\t\n\texports.logger = logger;\n\n/***/ },\n/* 4 */\n/***/ function(module, exports) {\n\n\t\"use strict\";\n\t\n\tObject.defineProperty(exports, \"__esModule\", {\n\t  value: true\n\t});\n\t\n\t// mocking for testing\n\t// TODO: do not include in prod\n\t// let BTN1 = BTN1 || null;\n\t// let P3 = P3 || null;\n\t// let Serial3 = Serial3 || null;\n\t\n\tvar settings = {\n\t  pin: {\n\t    knockPin: P2,\n\t    relayPin: P3,\n\t    bluetoothSerial: Serial3\n\t  }\n\t};\n\t\n\texports.settings = settings;\n\n/***/ },\n/* 5 */\n/***/ function(module, exports, __webpack_require__) {\n\n\t\"use strict\";\n\t\n\tObject.defineProperty(exports, \"__esModule\", {\n\t  value: true\n\t});\n\texports.KnockDevice = exports.Relay = exports.Bluetooth = undefined;\n\t\n\tvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\t\n\tvar _logger = __webpack_require__(3);\n\t\n\tvar _Utils = __webpack_require__(6);\n\t\n\tfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\t\n\t_logger.logger.log('Devices.js');\n\t\n\t/**\n\t * Bluetooth module\n\t * example:\n\t *\n\t  ```\n\t    import { Bluetooth } from \"./Devices\";\n\t    let options = {\n\t      serialPort: <Object> // e.g. Serial3\n\t      baudRate: <Number> // e.g. 9600 <- this is default\n\t      debounceTimeout: <Number> // e.g. 100 <- this is default\n\t    };\n\t    let bluetooth = new Bluetooth(options);\n\t  ```\n\t *\n\t */\n\tvar DEFAULT_BAUD_RATE = 9600;\n\tvar DEFAULT_DEBOUNCE_TIMEOUT = 100;\n\t\n\tvar Bluetooth = function () {\n\t  function Bluetooth(options) {\n\t    var _this = this;\n\t\n\t    _classCallCheck(this, Bluetooth);\n\t\n\t    var serial = options.serialPort;\n\t    var rate = options.baudRate || DEFAULT_BAUD_RATE;\n\t    var debouceTimeout = options.debounceTimeout || DEFAULT_DEBOUNCE_TIMEOUT;\n\t    serial.setup(rate);\n\t\n\t    this.receivedDataArray = [];\n\t    this.onDataReceivedCallback = function () {};\n\t\n\t    this.onDataReceivedDebounced = (0, _Utils.debounce)(function () {\n\t      _this._onDataReceived();\n\t    }, debouceTimeout);\n\t\n\t    serial.on('data', this.onDataReceiving.bind(this));\n\t  }\n\t\n\t  _createClass(Bluetooth, [{\n\t    key: \"onDataReceiving\",\n\t    value: function onDataReceiving(data) {\n\t      this.receivedDataArray.push(data);\n\t      this.onDataReceivedDebounced();\n\t    }\n\t  }, {\n\t    key: \"_onDataReceived\",\n\t    value: function _onDataReceived() {\n\t      var data = this.receivedDataArray.join(\"\");\n\t      _logger.logger.log(\"Bluetooth._onDataReceoved\", data);\n\t      this.onDataReceivedCallback(data);\n\t      this.receivedDataArray = [];\n\t    }\n\t  }, {\n\t    key: \"onDataReceived\",\n\t    value: function onDataReceived(callback) {\n\t      this.onDataReceivedCallback = callback || function () {};\n\t    }\n\t  }]);\n\t\n\t  return Bluetooth;\n\t}();\n\t\n\t/**\n\t * Relay utility module\n\t * example:\n\t *\n\t\n\t ```\n\t  import { Relay } from \"./Devices\";\n\t  let options = {\n\t    pin: <Object>, // e,g, P1\n\t  };\n\t  let relay = new Relay(options);\n\t\n\t  relay.set(1);\n\t  relay.set(true);\n\t  relay.set(0);\n\t  relay.set(false);\n\t\n\t ```\n\t *\n\t */\n\t\n\tvar Relay = function () {\n\t  function Relay(options) {\n\t    _classCallCheck(this, Relay);\n\t\n\t    this.pin = options.pin;\n\t  }\n\t\n\t  _createClass(Relay, [{\n\t    key: \"set\",\n\t    value: function set(bool) {\n\t      this.pin.write(bool ? 1 : 0);\n\t    }\n\t  }]);\n\t\n\t  return Relay;\n\t}();\n\t\n\t/**\n\t * KnockDevice module\n\t * example:\n\t *\n\t ```\n\t import { KnockDevice } from \"./Devices\";\n\t let options = {\n\t      pin: <Object>, // e,g, P1\n\t      setWatchOpts: <Object> // opts passed to setWatch fn\n\t    };\n\t let knockDevice = new KnockDevice(options);\n\t knockDevice.onKnock((e)=>{\n\t  // callback when knock\n\t });\n\t ```\n\t *\n\t */\n\t\n\tvar KNOCK_DEVICE_SET_WATCH_OPTS_DEFAULT = {\n\t  repeat: true,\n\t  debounce: 20,\n\t  edge: 'rising'\n\t};\n\tvar KNOCK_DEVICE_DEBOUNCE = 100;\n\t\n\tvar KnockDevice = function () {\n\t  function KnockDevice(options) {\n\t    var _this2 = this;\n\t\n\t    _classCallCheck(this, KnockDevice);\n\t\n\t    _logger.logger.log(\"setup KnockDevice\");\n\t    var pin = options.pin;\n\t    var setWatchOpts = options.setWatchOpts || KNOCK_DEVICE_SET_WATCH_OPTS_DEFAULT;\n\t    this.onKnockCallback = function () {};\n\t\n\t    // here we use KNOCK_DEVICE_DEBOUNCE\n\t    // in order to catch only first knocking\n\t    var shakeTimeout = void 0;\n\t    var watcher = function watcher(e) {\n\t      if (shakeTimeout) return;\n\t      _this2.onKnockEvent(e);\n\t      shakeTimeout = setTimeout(function () {\n\t        shakeTimeout = undefined;\n\t      }, KNOCK_DEVICE_DEBOUNCE);\n\t    };\n\t\n\t    setWatch(watcher, pin, setWatchOpts);\n\t  }\n\t\n\t  _createClass(KnockDevice, [{\n\t    key: \"onKnockEvent\",\n\t    value: function onKnockEvent(e) {\n\t      _logger.logger.log(\"KnockDevice onKnockEvent\");\n\t      this.onKnockCallback(e);\n\t    }\n\t  }, {\n\t    key: \"onKnock\",\n\t    value: function onKnock(callback) {\n\t      this.onKnockCallback = callback || function () {};\n\t    }\n\t  }]);\n\t\n\t  return KnockDevice;\n\t}();\n\t\n\texports.Bluetooth = Bluetooth;\n\texports.Relay = Relay;\n\texports.KnockDevice = KnockDevice;\n\n/***/ },\n/* 6 */\n/***/ function(module, exports) {\n\n\t\"use strict\";\n\t\n\tObject.defineProperty(exports, \"__esModule\", {\n\t  value: true\n\t});\n\tvar debounce = function debounce(func, wait, immediate) {\n\t  var timeoutId = null;\n\t  return function () {\n\t    var context = this,\n\t        args = arguments;\n\t    var later = function later() {\n\t      timeoutId = null;\n\t      if (!immediate) func.apply(context, args);\n\t    };\n\t    var callNow = immediate && !timeoutId;\n\t    if (timeoutId) clearTimeout(timeoutId);\n\t    timeoutId = setTimeout(later, wait);\n\t    if (callNow) func.apply(context, args);\n\t  };\n\t};\n\t\n\texports.debounce = debounce;\n\n/***/ },\n/* 7 */\n/***/ function(module, exports, __webpack_require__) {\n\n\t\"use strict\";\n\t\n\tObject.defineProperty(exports, \"__esModule\", {\n\t  value: true\n\t});\n\texports.SignalDetectionService = undefined;\n\t\n\tvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\t\n\tvar _logger = __webpack_require__(3);\n\t\n\tvar _Utils = __webpack_require__(6);\n\t\n\tfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\t\n\t_logger.logger.log('signal-detection.js', 'loaded');\n\t\n\t/**\n\t *\n\t * Service that helps to putTimestamp timestamped code\n\t *\n\t */\n\t\n\tvar CODE_DETECT_TIMEOUT_DEFAULT = 2000;\n\t\n\tvar SignalDetectionService = function () {\n\t  function SignalDetectionService() {\n\t    _classCallCheck(this, SignalDetectionService);\n\t\n\t    this.codeDetectionTimeout = CODE_DETECT_TIMEOUT_DEFAULT;\n\t    this.signalTimestamps = [];\n\t    this.signalDetectionInProgress = false;\n\t\n\t    this.updateCodeDetectionDebounced();\n\t  }\n\t\n\t  _createClass(SignalDetectionService, [{\n\t    key: \"updateCodeDetectionDebounced\",\n\t    value: function updateCodeDetectionDebounced() {\n\t      var codeDetectionTimeout = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : this.codeDetectionTimeout || CODE_DETECT_TIMEOUT_DEFAULT;\n\t\n\t      _logger.logger.log('SignalDetectionService.updateCodeDetectionDebounced()', codeDetectionTimeout);\n\t      this.detectCodeDebounced = (0, _Utils.debounce)(this.onCodeDetected.bind(this), codeDetectionTimeout);\n\t    }\n\t\n\t    /**\n\t     * @param timestamp\n\t     */\n\t\n\t  }, {\n\t    key: \"putTimestamp\",\n\t    value: function putTimestamp(timestamp) {\n\t      _logger.logger.log('SignalDetectionService.putTimestamp()', timestamp);\n\t      if (this.signalDetectionInProgress) {\n\t        this.signalTimestamps.push(timestamp);\n\t      }\n\t      this.signalDetectionInProgress = true;\n\t      this.detectCodeDebounced();\n\t    }\n\t  }, {\n\t    key: \"onCodeDetected\",\n\t    value: function onCodeDetected() {\n\t      _logger.logger.log(\"SignalDetectionService.onCodeDetected\", 'called');\n\t\n\t      var callback = this.onSignalDetectCallback || function () {};\n\t      callback(this.signalTimestamps);\n\t\n\t      this.signalTimestamps = [];\n\t      this.signalDetectionInProgress = false;\n\t    }\n\t  }, {\n\t    key: \"onSignalDetect\",\n\t    value: function onSignalDetect(callback) {\n\t      this.onSignalDetectCallback = callback; // todo check context\n\t    }\n\t  }, {\n\t    key: \"setDetectionTimeout\",\n\t    value: function setDetectionTimeout(timeout) {\n\t      this.codeDetectionTimeout = timeout;\n\t      this.updateCodeDetectionDebounced();\n\t    }\n\t  }, {\n\t    key: \"getTimestamps\",\n\t    value: function getTimestamps() {\n\t      return this.signalTimestamps;\n\t    }\n\t  }]);\n\t\n\t  return SignalDetectionService;\n\t}();\n\t\n\texports.SignalDetectionService = SignalDetectionService;\n\n/***/ }\n/******/ ])\n});\n;\n"],"sourceRoot":"/source/"}